# warpd (Non-Latin Layout Fork)

> **This is a fork of [warpd](https://github.com/rvaiya/warpd) by Raheman Vaiya.**
>
> This fork is based on [B1T3X's fork](https://gitlab.com/B1T3X/warpd) with additional improvements.
>
> This fork fixes issues with non-Latin keyboard layouts (Hebrew, Russian, Arabic, etc.) on macOS where the original version would become unresponsive. It also adds visual ripple effects, horizontal scrolling, and other enhancements. See [FORK_CHANGES.md](FORK_CHANGES.md) for details.

---

# What

A modal keyboard driven interface for mouse manipulation.

# Demo

## Hint Mode `Alt-Meta-x`

<p align="center">
<img src="demo/hints.gif" height="400px"/>
</p>

## Grid Mode `Alt-Meta-g`

<p align="center">
<img src="demo/warp.gif" height="400px"/>
</p>

## Normal Mode `Alt-Meta-c`

<p align="center">
<img src="demo/discrete.gif" height="400px"/>
<img src="demo/discrete2.gif" height="400px" width="711px"/>
</p>


# Dependencies

## X

The usual array of X libraries:

 - libxi
 - libxinerama
 - libxft
 - libxfixes
 - libxtst
 - libx11

## Wayland (sway/wlroots only (**no gnome support**))

 - libwayland-client
 - cairo
 - xkbcommon

*Note:* The wayland port has several limitations due
to the nature of Wayland's architecture.

See the LIMITATIONS section of the man page for more details.

## MacOS:

 - The standard Xcode command line developer tools.

# Installation

Make sure you have the appropriate dependencies for your system:

E.g

## debian/ubuntu:

```
git clone https://github.com/rvaiya/warpd.git
cd warpd
sudo apt-get install \
	libxi-dev \
	libxinerama-dev \
	libxft-dev \
	libxfixes-dev \
	libxtst-dev \
	libx11-dev \
	libcairo2-dev \
	libxkbcommon-dev \
	libwayland-dev &&
make && sudo make install
```

By default warpd will build a single binary for both X and wayland. An X or
Wayland only binary can be generated by setting either `DISABLE_WAYLAND` or
`DISABLE_X` at compile time.

## macos:

```
curl -L https://github.com/rvaiya/warpd/releases/download/v1.3.5/warpd-1.3.5-osx.tar.gz |  sudo tar xzvfC - / && launchctl load /Library/LaunchAgents/com.warpd.warpd.plist
```

Uninstallation:

```
sudo rm /usr/local/bin/warpd /usr/local/share/man/man1/warpd.1.gz /Library/LaunchAgents/com.warpd.warpd.plist
```

or (from source)

```
# Install the xcode command line tools if you
# don't already have them.
xcode-select --install

make && sudo make install && launchctl load /Library/LaunchAgents/com.warpd.warpd.plist
```

Uninstallation:

```
sudo make uninstall
```

*Note:* On initialization you may be prompted to add the warpd binary to your
accessibility settings. **If you are upgrading it may also be necessary to run
`sudo tccutil reset Accessibility` (this will remove all applications
from your accessibility settings)**. The service is now also managed by a
launchd service (see below) and should not be explicitly started by the
user.

*Note 2:* Some programs (e.g iTerm) have a 'secure input mode' that may need to be
disabled in order for warpd to work properly.

The service can be disabled with

```
launchctl unload /Library/LaunchAgents/com.warpd.warpd.plist
```

# Quickstart

1. Run `warpd`

## Hint Mode
2. Press `A-M-x` (`alt+meta+x`) to generate a list of hints
3. Enter the key sequence associated with the desired target to warp the pointer to that location and enter normal mode.
4. Use the normal mode movement keys to select the final desination (see Normal Mode).

## Grid Mode
2. Press `A-M-g` (meta is the command key) to activate the warping process.
3. Use `u`,`i`,`j`,`k` to repeatedly navigate to different quadrants.
4. Press `m` to left click, `,` to middle click or `.` to right click.
5. See Normal Mode

## Normal Mode
2. Press `A-M-c` to activate normal mode.
3. Use the normal movement keys (default `hjkl`) to adjust the cursor.
4. Press `m` to left click, `,` to middle click or `.` to right click.
5. Press `escape` to quit.

A drag movement can be simulated from any of the above modes by focusing on the
source and then pressing the `drag_key` (default `v`) which will cause normal
mode to be activated for selection of the drag target.

A more comprehensive description can be found in the [man page](warpd.1.md) (along with a list of options).

# Default Keymappings

## Mode Activation (Global)

| Key | Action | Description |
|-----|--------|-------------|
| `Alt-Cmd-x` | Hint Mode | Generate hints for clickable elements |
| `Alt-Cmd-X` | Hint Mode (2-pass) | Two-step hint selection for more targets |
| `Alt-Cmd-l` | Hint Mode (oneshot) | Hint mode that exits after selection |
| `Alt-Cmd-L` | Hint Mode 2 (oneshot) | Two-pass hint mode that exits after selection |
| `Alt-Cmd-g` | Grid Mode | Activate grid-based cursor positioning |
| `Alt-Cmd-c` | Normal Mode | Manual cursor movement with keyboard |
| `Alt-Cmd-h` | History Mode | Navigate to previously clicked locations |
| `Alt-Cmd-s` | Screen Selection | Select which screen to operate on |

## Normal Mode

### Cursor Movement

| Key | Action | Description |
|-----|--------|-------------|
| `h` | Move Left | Move cursor left |
| `j` | Move Down | Move cursor down |
| `k` | Move Up | Move cursor up |
| `l` | Move Right | Move cursor right |
| `H` | Jump to Top | Move cursor to top of screen |
| `M` | Jump to Middle | Move cursor to middle of screen |
| `L` | Jump to Bottom | Move cursor to bottom of screen |
| `0` | Jump to Start | Move cursor to leftmost edge |
| `$` | Jump to End | Move cursor to rightmost edge |

### Speed Modifiers

| Key | Action | Description |
|-----|--------|-------------|
| `a` | Accelerator | Increase cursor speed while held (2900 px/sÂ²) |
| `d` | Decelerator | Slow cursor for precision (50 px/s) |

### Scrolling (Smooth)

| Key | Action | Description |
|-----|--------|-------------|
| `e` | Scroll Down | Smooth scroll down (with acceleration) |
| `r` | Scroll Up | Smooth scroll up (with acceleration) |
| `t` | Scroll Left | Smooth scroll left (with acceleration) |
| `y` | Scroll Right | Smooth scroll right (with acceleration) |

### Scrolling (Instant)

| Key | Action | Description |
|-----|--------|-------------|
| `f` | Page Down | Instant scroll down one page (800 units) |
| `b` | Page Up | Instant scroll up one page (800 units) |
| `z` | Home/Top | Instant scroll to top (100000 units) |
| `Z` | End/Bottom | Instant scroll to bottom (100000 units) |

### Mouse Actions

| Key | Action | Description |
|-----|--------|-------------|
| `m` | Left Click | Standard left mouse button click |
| `,` | Middle Click | Middle mouse button click |
| `.` | Right Click | Right mouse button click (context menu) |
| `n` | Left Click (oneshot) | Click and exit normal mode |
| `-` | Middle Click (oneshot) | Middle click and exit normal mode |
| `/` | Right Click (oneshot) | Right click and exit normal mode |
| `v` | Toggle Drag Mode | Enter/exit visual (drag) mode |
| `c` | Copy & Exit | Send copy command and exit |

### Mode Switching (From Normal Mode)

| Key | Action | Description |
|-----|--------|-------------|
| `x` | Hint Mode | Switch to hint mode |
| `X` | Hint Mode (2-pass) | Switch to two-pass hint mode |
| `g` | Grid Mode | Switch to grid mode |
| `s` | Screen Selection | Select different screen |
| `;` | History Mode | Show hint history |

### Other

| Key | Action | Description |
|-----|--------|-------------|
| `p` | Print Coordinates | Output cursor position to stdout |
| `Esc` | Exit | Exit warpd and return to normal usage |

## Grid Mode

| Key | Action | Description |
|-----|--------|-------------|
| `u` | Top-Left | Select top-left quadrant |
| `i` | Top-Right | Select top-right quadrant |
| `j` | Bottom-Left | Select bottom-left quadrant |
| `k` | Bottom-Right | Select bottom-right quadrant |
| `w` | Move Up | Move grid up |
| `a` | Move Left | Move grid left |
| `s` | Move Down | Move grid down |
| `d` | Move Right | Move grid right |
| `W` | Cut Up | Cut grid to upper half |
| `A` | Cut Left | Cut grid to left half |
| `S` | Cut Down | Cut grid to lower half |
| `D` | Cut Right | Cut grid to right half |
| `c` | Exit to Normal | Exit grid mode, return to normal mode |
| `Esc` | Exit | Exit warpd completely |

## History Mode

| Key | Action | Description |
|-----|--------|-------------|
| `Ctrl-o` | History Back | Navigate to previous position |
| `Ctrl-i` | History Forward | Navigate to next position |

## Configuration

All keybindings can be customized in `~/.config/warpd/config`. See the [man page](warpd.1.md) for complete configuration options.

Example config snippet:
```
# Customize scroll keys
scroll_left: q
scroll_right: w

# Adjust scroll amounts
scroll_page_amount: 1000
scroll_home_amount: 8000

# Change cursor movement keys
left: a
down: s
up: w
right: d

# Hint font (monospace recommended for distinguishing I/l/1)
# macOS PostScript names: Menlo-Regular (default), Monaco, Courier
# Linux xft names: Monospace, DejaVu Sans Mono, Liberation Mono
hint_font: Menlo-Regular

# Hint appearance
hint_bgcolor: #1c1c1e
hint_fgcolor: #a1aba7
hint_size: 20
hint_border_radius: 3

# Ripple effect (visual feedback on clicks and jumps)
ripple_enabled: 1
ripple_color: #00ff0060       # RGBA hex color (last 2 digits = alpha/transparency)
ripple_duration: 300          # Animation duration in milliseconds
ripple_max_radius: 50         # Maximum ripple radius in pixels
ripple_line_width: 2          # Width of ripple circle line

# Color examples for ripples:
# ripple_color: #ff000080      # Semi-transparent red
# ripple_color: #00ff00ff      # Opaque green
# ripple_color: #0080ff40      # Very transparent blue
# ripple_color: #ffff0060      # Semi-transparent yellow
```

## Wayland

*Note:* Wayland does not permit clients to globally bind hotkeys. These must be
bound within the compositor using warpd's oneshot flags.

E.g

**On sway**:

```
# warpd hotkeys

bindsym Mod4+Mod1+x exec warpd --hint
bindsym Mod4+Mod1+c exec warpd --normal
bindsym Mod4+Mod1+g exec warpd --grid
```

**Using sxhkd**:

```
# warpd hotkeys

Alt + super + x
  exec warpd --hint

Alt + super + c
  warpd --normal

Alt + super + g
  warpd --grid
```

# Packages:

`warpd` is currently available on the following distributions:

## Arch

Available in the [AUR](https://aur.archlinux.org/): [warpd](https://aur.archlinux.org/packages/warpd/), [warpd-wayland](https://aur.archlinux.org/packages/warpd-wayland), [warpd-git](https://aur.archlinux.org/packages/warpd-git) maintained by Matheus Fillipe.

If you are interesting in adding warpd to your distribution's repository please contact me.

# Limitations/Bugs

- Programs which use Xinput and or Xtest for keyboard may not work correctly
  (e.g synergy). If a specific program which you feel should be working does
  not please file an [issue](https://github.com/rvaiya/warpd/issues).

- The hack used for pointer hiding on OSX doesn't work on some programs (e.g
  iTerm). The original cursor will consequently be visible in such cases,
  though functionality should be otherwise unaffected.

- Wayland support has several limitations (see CAVEATS in the man page).

# Contributions

A special thanks to

 - Pete Fein - For encouragement and early adoption.
 - Matheus Fillipe - For the original border radius patch as well as numerous bug reports and feature requests.
 - The Kaleidoscope/Vimperator projects - For inspiration.
 - Drew Devault - For making the Wayland ecosystem inhabitable.
